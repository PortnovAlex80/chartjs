# Поиск очертания поверхности земли по данным лазерного сканирования

## Технологии

1. Node.js
2. Typescript
3. Chart.js

## Описание

Этот проект - это веб-приложение, разработанное для исследования алгоритмов поиска очертаняи поверхности земли за счет наглядного отображения графиков на основе данных, полученных из CSV-файлов. В его основе лежит использование библиотеки `Chart.js`, которая обеспечивает динамичное и интуитивно понятное визуальное представление данных, а также `Node.js` для эффективного функционирования серверной части. Использование `Typescript` обусловлено архитектурными соображениями. Ключевыми аспектами проекта являются применение вычислительной геометрии, методов регрессии и аппроксимации с использованием полиномов, а также метода наименьших квадратов для снижения погрешности исходных данных. При реализации проекта использовался Chatbot GPT-4 Math Mentor.

![Math mentor AI](/public/AppIcon.png)

## Структура папок

- `/public` - папка для статических файлов (HTML, JS, CSS).
- `/filters` - папка с модулями фильтров и алгоритмов обработки данных.
- `server.js` - основной файл сервера Node.js.
- `script.js` - скрипт отвечает за отправку запросов на сервер, получение и обработку данных, а также за инициализацию и обновление графиков в ответ на действия пользователя. 

## Установка

1. Установите Node.js и npm.
2. Установите зависимости: `npm install`

### Примечания
- Для корректной работы браузера убедитесь, что путь к исполняемому файлу Chromium верен и соответствует вашей системе.
- В коде предусмотрена автоматическая очистка процесса Chromium при закрытии сервера.

## Запуск

- Добавить файл csv с данными в виде [{x.xxx, y.yyy}] (разделитель `,`)
- Запуск сервера: `npm start`.

## Добавление и модификация алгоритмов и фильтров

1. Для добавления нового алгоритма или фильтра создайте соответствующий модуль в папке `/filters`. Новый фильтр или алгоритм должен принимать массив точек в формате `{ x: number, y: number }` и возвращать массив точек в том же формате.
2. Импортируйте и применяйте новый алгоритм или фильтр в модуле `/public/ChartDataAggregator.js`. Убедитесь, что входные и выходные данные соответствуют требуемому формату точек.
3. Для интеграции алгоритма или фильтра в график, модифицируйте функцию `ChartDataAggregator` так, чтобы она включала результаты работы нового алгоритма или фильтра. Это позволит автоматически интегрировать результаты в графики, отображаемые на веб-странице.

## Основные Функции

### `ChartDataAggregator`

- **Описание**: Агрегирует и обрабатывает данные для визуализации графиков.
- **Параметры**:
  - `csvpoints`: Массив точек из CSV-файла.
  - `coordinateA`: Начальная координата X для фильтрации данных (передается с веб формы).
  - `coordinateB`: Конечная координата X для фильтрации данных (передается с веб формы).
- **Возвращаемое значение**: Promise -> возвращающий массив наборов данных для визуализации.

### Фильтры основы алгоритма Enchance-18

#### `weightedGroundLevelMedianFilter`

- **Описание**: Взвешенный медианный фильтр по уровню земли, ищущий в каждом окне точку с наименьшей координатой Y и присваивающий ей максимальный вес.
- **Параметры**:
  - `points`: Массив точек для фильтрации.
  - `maxWindowSize`: Максимальный размер окна для медианной фильтрации.
  - `maxLength`: Максимальная длина интервала для одного окна фильтрации.
- **Возвращаемое значение**: Отфильтрованный набор точек.

### `CubicPolynomialApproximation`

- **Общие сведения**: Класс для аппроксимации данных с использованием кубического полинома методом наименьших квадратов.

#### Описание Метода `findRandomQualitySegments`
Метод `findRandomQualitySegments` представляет собой уникальный подход к анализу и обработке набора точек для определения прямолинейных участков. Алгоритм использует случайный выбор точек в качестве начальной точки для каждого сегмента и последовательно расширяет сегмент в обе стороны, пока условия заданной аппроксимации (по значениям RMSE) не будут нарушены.

#### Особенности Алгоритма
1. **Случайный Выбор Начальных Точек:**
   Алгоритм начинает с случайно выбранной точки в наборе, что позволяет избежать предвзятости, связанной с последовательным подходом, и обеспечивает более равномерное покрытие всего диапазона данных.

2. **Динамическое Расширение Сегментов:**
   Сегменты расширяются влево и вправо от начальной точки до тех пор, пока не перестанут соответствовать заданным критериям аппроксимации, обеспечивая гибкость в обработке данных.

3. **Эффективное Управление Сегментами:**
   Алгоритм отслеживает и исключает обработанные сегменты, предотвращая повторную обработку и повышая эффективность.

4. **Избежание Зацикливания:**
   Включены механизмы для предотвращения бесконечного цикла, что критически важно для обеспечения стабильности и надежности работы алгоритма.

## Как использовать

1. Импортируйте необходимые модули в ваш проект.
2. Подготовьте данные в виде массива точек.
3. Используйте `ChartDataAggregator` для агрегации и обработки данных.
4. Применяйте дополнительные фильтры по необходимости.

## Зависимости

Проект зависит от следующих модулей и библиотек:

- `IDataSet`, `IPoint`, `IFilter` для структурирования данных.

## Лицензия
---
## Краткое резюме по алгоритмической части

### Примененные механизмы регрессии и фильтрации
- **Взвешенный медианный фильтр**: Уменьшает шум и выбросы в данных, адаптирован автором для особенностей лазерного сканирования путем добавления весов к точками, приближенным к поверхности земли.
- **Метод наименьших квадратов**: Применяется для линейной аппроксимации точек, минимизируя отклонения.
- **Кубическая полиномиальная аппроксимация**: Создает сложные кривые для лучшего соответствия данным, с оценкой точности через RMSE.
- **Поиск оптимального пути в графе**: Использует комбинаторику и стратегии поиска оптимального пути для выбора наилучших сегментов данных, авторская адаптация заключается в расчете поощрительных баллов в **функции `OptimaFunction`** за длину сегмента и количество удаленных вершин.

### Нерешенные проблемы
Автор кода столкнулся с задачей аппроксимации данных кусочным полиномом степени N, но не смог полностью реализовать этот подход из-за сложности нахождения решения системы уравнений, учитывающей равенство координат и производных на границах сегментов. В отличие от кубического сплайна интерполяции, который точно проходит через все точки данных и имеет "квадратную" систему уравнений с однозначным решением, аппроксимация является более сложной задачей, требующей баланса между точностью и гладкостью аппроксимированной функции.

### Заключение
Примененные алгоритмы и методы отражают комплексный и многоуровневый подход к анализу и обработке данных, демонстрируя способность автора к решению сложных задач анализа данных с использованием продвинутых методов прикладной математики и программирования. Это подчеркивает глубокое понимание математических и алгоритмических принципов, необходимых для эффективной работы с сложными наборами данных. Особое значение применяемые алгоритмы обретают в областях Data Science и Machine Learning. В частности, концепции **регрессии**, фильтрации и поиска оптимальных решений являются ключевыми элементами в этих дисциплинах. Регрессионные модели, такие как метод наименьших квадратов и полиномиальная аппроксимация, используются для моделирования и прогнозирования зависимостей между переменными. Фильтрация данных, в том числе взвешенный медианный фильтр, важна для очистки и подготовки данных к анализу. Поиск оптимальных решений в этом контексте можно сравнить с задачами оптимизации, где цель состоит не в поиске кратчайшего пути, а в максимизации или минимизации определенной целевой функции в соответствии с заданными критериями. Это включает в себя балансировку между различными параметрами и ограничениями, что является фундаментальным навыком в **Data Science и Machine Learning**.

## Расширенное описание алгоритмической части

### Применяемый Алгоритм: Взвешенный Медианный Фильтр

#### Описание
Этот алгоритм используется для предварительной обработки данных, полученных в результате лазерного сканирования. Медианный фильтр применяется для уменьшения шума и случайных выбросов, при этом сохраняя ключевые структурные особенности данных. Основная идея заключается в выборе медианного значения из набора точек в пределах определенного окна, что помогает сгладить данные, сохраняя важные тенденции и уменьшая влияние аномалий.

#### Авторская Адаптация: Добавление Веса к Точкам, Близким к Поверхности Земли
Особенностью данных лазерного сканирования является то, что отраженные точки не могут находиться ниже уровня земной поверхности. Исходя из этого свойства, была разработана авторская адаптация медианного фильтра. В этой модификации, точкам, расположенным ближе к предполагаемой поверхности земли, присваивается больший вес. Это увеличивает их влияние на итоговое медианное значение, улучшая тем самым точность отфильтрованных данных. Такой подход эффективно снижает влияние аномальных отражений, которые могут возникать из-за шума или других артефактов лазерного сканирования.

---

### Применяемый Алгоритм: Фильтр Метода Наименьших Квадратов

#### Общее 
Этот алгоритм применяется для аппроксимации набора точек прямой линией, методом наименьших квадратов. Он предназначен для нахождения наилучшей линии, которая минимизирует сумму квадратов отклонений каждой точки данных от этой линии. Это широко используемый статистический метод для анализа линейных взаимосвязей между переменными.

#### Работа Алгоритма
1. **Вычисление Параметров Линии**
   - Для заданного набора точек `(x, y)` алгоритм сначала вычисляет наклон (`slope`) и пересечение (`intercept`) линии.
   - Эти параметры определяются путем вычисления сумм `sumX`, `sumY`, `sumXY`, `sumXX`, и применения формул наименьших квадратов.

2. **Обработка Особых Случаев**
   - Если точек меньше двух, алгоритм возвращает исходный набор точек, так как для аппроксимации прямой требуется минимум две точки.

3. **Аппроксимация и Возвращение Результатов**
   - Алгоритм возвращает начальную и конечную точки, соответствующие вычисленной линии наименьших квадратов. Это позволяет представить аппроксимированную линию на основе исходного набора данных.

4. **Расчет Среднеквадратичной Ошибки (RMSE)**
   - Рассчитывается RMSE (Root Mean Square Error), который представляет собой квадратный корень из среднего значения квадратов разностей между наблюдаемыми и предсказанными значениями Y. Это мера точности аппроксимации.

---

### Описание Алгоритма: Обход кратчайшим путем с функцией оптимизации с учетом баллов за максимизацию длины и количества удаленных вершин

#### Общее Описание
Этот алгоритм представляет собой комбинацию методов комбинаторики и оптимизации кратчайшего пути для определения оптимальных сегментов в наборе точек, полученных из лазерного сканирования или подобных геоданных. Целью является определение таких сегментов полилинии, которые минимизируют суммарную ошибку (RMSE) и при этом сохраняют структурную целостность данных.

#### Работа Алгоритма
1. **Вычисление RMSE с Применением Фильтра Метода Наименьших Квадратов**
   - Для каждого возможного сегмента полилинии рассчитывается RMSE (Root Mean Square Error), используя метод наименьших квадратов для аппроксимации и сравнения с исходными точками поверхности.

2. **Определение Оптимальных Сегментов**
   - Алгоритм итеративно рассматривает все возможные сегменты и выбирает те, которые удовлетворяют заданному порогу RMSE.
   - При этом также применяется функция `optimaFunction`, которая учитывает количество удаленных вершин и длину сегмента, для балансировки между точностью аппроксимации и сохранением детальности полилинии.

3. **Восстановление Оптимального Пути**
   - После вычисления оптимальных сегментов восстанавливается путь, соответствующий выбранным сегментам, для представления оптимальной полилинии.

#### Авторская Доработка: Функция `optimaFunction`
- Эта функция уникальна для данного алгоритма и предназначена для определения баланса между удалением вершин полилинии и сохранением ее общей длины.
- Она позволяет контролировать степень упрощения полилинии, уделяя внимание как удалению излишних точек, так и сохранению основной формы и размера полилинии.

---

### Описание Алгоритма: Кубическая Полиномиальная Аппроксимация (регрессия) и Фильтр Метода Наименьших Квадратов

#### Общее Описание
Алгоритм `CubicPolynomialApproximation` представляет собой комплексный подход к обработке и анализу данных, основанный на кубической полиномиальной аппроксимации и методе наименьших квадратов. Цель состоит в том, чтобы найти наилучшее приближение для набора точек, минимизируя ошибки и предоставляя гладкое представление данных.

#### Ключевые Элементы Алгоритма
1. **Кубическая Полиномиальная Аппроксимация**
   - Вычисление коэффициентов кубического полинома, который наилучшим образом соответствует исходному набору точек.
   - Используется метод решения системы линейных уравнений для определения этих коэффициентов.

2. **Фильтр Метода Наименьших Квадратов**
   - Применяется для создания упрощенной линейной аппроксимации исходных точек. Это обеспечивает дополнительную оценку точности полиномиальной аппроксимации.

3. **Оценка Точности**
   - Вычисление RMSE (Root Mean Square Error) для обеих аппроксимаций (полиномиальной и линейной), что позволяет оценить и сравнить точность обеих моделей.

4. **Поиск Оптимальных Сегментов**
   - Алгоритм также включает методику поиска и выделения наилучших сегментов данных, основываясь на заданных критериях точности и различия между двумя аппроксимациями.

5. **Авторская Доработка**
   - Особенностью является введение дополнительных условий при определении оптимальных сегментов, таких как пороговые значения RMSE и сравнительный анализ разницы в RMSE между полиномиальной и линейной аппроксимациями.

